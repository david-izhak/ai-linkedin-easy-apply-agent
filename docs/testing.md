# Тестирование

Качественная тестовая система — залог стабильности и надежности проекта. В этом разделе описывается архитектура тестов, их типы и способы запуска.

## Структура тестов

Тестовая система проекта разделена на два основных уровня, расположенных в директории `tests/`:

- **`unit/` (Unit-тесты):** Предназначены для проверки отдельных, изолированных компонентов (функций или классов) без взаимодействия с внешними системами.
- **`integration/` (Интеграционные тесты):** Проверяют взаимодействие между несколькими компонентами, работу с базой данных и корректность выполнения сквозных сценариев.

Ключевой файл `tests/conftest.py` содержит общие фикстуры, в том числе для создания изолированной in-memory базы данных для каждого теста.

## Unit-тесты

- **Цель:** Проверить корректность логики отдельных модулей.
- **Инструменты:** `pytest`, `pytest-asyncio`, `unittest.mock`.
- **Покрытие:**
    - **`core/`**: Тестирование CRUD-операций с базой данных (`test_database_unit.py`), утилит (`test_utils.py`), метрик (`test_metrics.py`), resilience (`test_resilience.py`).
    - **`actions/`**: Проверка логики входа, скрейпинга и подачи заявок с мокированием `Playwright`.
    - **`phases/`**: Тестирование логики каждой фазы, включая проверку `_is_job_suitable` с мокированием LLM-клиента.
    - **`llm/`**: Детальное тестирование модуля LLM, включая:
        - Устойчивость к некорректным JSON-ответам от модели.
        - Корректность инициализации клиента для разных провайдеров.
        - Логику `is_vacancy_suitable`.
    - **`apply_form/`**: Тестирование каждого обработчика полей формы.

## Интеграционные тесты

- **Цель:** Проверить, что компоненты корректно работают вместе.
- **Инструменты:** `pytest`, `pytest-playwright` (в синхронном режиме), фикстуры.
- **Покрытие:**
    - **`test_database_flow.py`**: Проверяет полный жизненный цикл вакансии в базе данных (переход по статусам).
    - **`test_phases_flow.py`**: Тестирует сквозной сценарий взаимодействия фаз `Discovery` -> `Enrichment` -> `Processing`.
    - **`test_scraping_logic.py`**: Проверяет логику скрейпинга с использованием реальных (но сохраненных локально) HTML-файлов страниц LinkedIn из директории `fixtures/`.
    - **LLM filter fallback**: Проверяет, что при сбое LLM-фильтрации корректно вызывается резервная логика на основе ключевых слов.

## Запуск тестов

Проект использует `uv` для управления зависимостями и запуска тестов. Для удобства тесты разделены на две группы.

- **Запуск Unit-тестов:**
  ```bash
  uv run pytest tests/unit -v
  ```

- **Запуск интеграционных тестов:**
  ```bash
  uv run pytest tests/integration -v
  ```

- **Запуск всех тестов:**
  ```bash
  uv run pytest tests/ -v
  ```

## Рекомендации по улучшению

**Рекомендации:**

- **Расширение покрытия:** Необходимо добавить больше интеграционных тестов на негативные сценарии (например, ошибки в середине процесса).
- **Параметризация:** Использовать параметризованные тесты для проверки логики фильтрации с более широким набором входных данных.
- **Добавление E2E тестов:** В будущем стоит рассмотреть возможность добавления полноценных End-to-End тестов, которые будут запускать `full_run` на тестовом аккаунте LinkedIn.

---

## Дополнительная информация

- [Структура проекта](project-structure.md) - Детальное описание структуры тестов
- [Архитектура проекта](architecture.md)
- [Описание компонентов](components.md)
- [Руководство по началу работы](getting-started.md)